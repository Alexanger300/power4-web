<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Puissance 4</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body class="power4-body">
  <h1>Puissance 4</h1>

  <!-- Boutons colonnes -->
  <div id="currentPlayer"></div>
  <div id="columns"></div>

  <!-- Grille -->
  <div id="board"></div>
  <div id="winnerMessage" style="font-size: 24px; color: green; margin-top: 10px;"></div>
  <button id="restartBtn" class="restartbtn">Nouvelle partie</button>

<script>
const difficulty = localStorage.getItem('difficulty') || 'facile';
let rows, cols;

if (difficulty === 'facile') { rows = 6; cols = 7; }
else if (difficulty === 'moyen') { rows = 6; cols = 9; }
else if (difficulty === 'difficile') { rows = 7; cols = 8; }

const boardDiv = document.getElementById('board');
const columnsDiv = document.getElementById('columns');
const winnerDiv = document.getElementById('winnerMessage');
const restartBtn = document.getElementById('restartBtn');

let board = Array.from({ length: rows }, () => Array(cols).fill(''));
let currentPlayer = 'Paris';
document.getElementById('currentPlayer').textContent = `Tour actuel : ${currentPlayer}`;
// Adapter la grille CSS
boardDiv.style.gridTemplateRows = `repeat(${rows}, 55px)`;
boardDiv.style.gridTemplateColumns = `repeat(${cols}, 55px)`;

// Générer les boutons de colonnes dynamiques
for (let c = 0; c < cols; c++) {
    const btn = document.createElement('button');
    btn.textContent = c + 1;
    btn.addEventListener('click', () => play(c));
    columnsDiv.appendChild(btn);
}

function renderBoard() {
    boardDiv.innerHTML = '';
    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');

            if (board[r][c]) {
                const img = document.createElement('img');
                img.src = board[r][c] === 'Paris' ? '../css/images/PSG.png' : '../css/images/BAR.png';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.borderRadius = '50%';
                cell.appendChild(img);
            }

            boardDiv.appendChild(cell);
        }
    }
}

function checkWinner() {
    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
            const p = board[r][c];
            if (!p) continue;

            // Horizontal
            if (c + 3 < cols &&
                board[r][c+1] === p &&
                board[r][c+2] === p &&
                board[r][c+3] === p) return p;

            // Vertical
            if (r + 3 < rows &&
                board[r+1][c] === p &&
                board[r+2][c] === p &&
                board[r+3][c] === p) return p;

            // Diagonale droite-bas
            if (r + 3 < rows && c + 3 < cols &&
                board[r+1][c+1] === p &&
                board[r+2][c+2] === p &&
                board[r+3][c+3] === p) return p;

            // Diagonale gauche-bas
            if (r + 3 < rows && c - 3 >= 0 &&
                board[r+1][c-1] === p &&
                board[r+2][c-2] === p &&
                board[r+3][c-3] === p) return p;
        }
    }
    return null;
}

function play(col) {
    for (let r = rows - 1; r >= 0; r--) {
        if (board[r][col] === '') {
            board[r][col] = currentPlayer;
            break;
        }
        if (r === 0) return;
    }
    renderBoard();
    document.getElementById('currentPlayer').textContent = `Tour actuel : ${currentPlayer}`;


    const winner = checkWinner();
    if (winner) {
        winnerDiv.textContent = `Le gagnant est : ${winner}`;
        disableButtons();
        restartBtn.style.display = 'inline-block';
        return;
    }

   if (board.flat().every(cell => cell !== '')) {
    const boardDiv = document.getElementById('board');

    // On vide le plateau et on met une grande image à la place
    boardDiv.innerHTML = `
        <img src="../css/images/Match-nul.jpg"
             alt="Match nul"
             class="match-image">
    `;

    // On affiche le message et le bouton
    winnerDiv.textContent = "Match nul !";
    disableButtons();
    restartBtn.style.display = 'inline-block';
    return;
}
    currentPlayer = currentPlayer === 'Paris' ? 'Barcelone' : 'Paris';
    document.getElementById('currentPlayer').textContent = `Tour actuel : ${currentPlayer}`;
}

function disableButtons() {
    document.querySelectorAll('#columns button').forEach(btn => btn.disabled = true);
}

restartBtn.addEventListener('click', () => {
    board = Array.from({ length: rows }, () => Array(cols).fill(''));
    currentPlayer = 'Paris';
    winnerDiv.textContent = '';
    restartBtn.style.display = 'none';
    document.querySelectorAll('#columns button').forEach(btn => btn.disabled = false);
    renderBoard();

});

renderBoard();

</script>
</body>
</html>