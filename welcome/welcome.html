<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Puissance 4</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <h1>Puissance 4</h1>

    <!-- Boutons colonnes -->
    <div id="columns">
        <button data-col="0">0</button>
        <button data-col="1">1</button>
        <button data-col="2">2</button>
        <button data-col="3">3</button>
        <button data-col="4">4</button>
        <button data-col="5">5</button>
        <button data-col="6">6</button>
    </div>

    <!-- Grille -->
    <div id="board"></div>
    <div id="winnerMessage" style="font-size: 24px; margin-top: 10px; color: green;"></div>
    <button id="restartBtn" style="display:none; margin-top:10px;">Nouvelle partie</button>

    <script>
        const boardDiv = document.getElementById("board");
const buttons = document.querySelectorAll("#columns button");
const winnerDiv = document.getElementById("winnerMessage");
const restartBtn = document.getElementById("restartBtn");

function updateBoard(text) {
    boardDiv.innerHTML = "";
    winnerDiv.textContent = "";
    restartBtn.style.display = "none"; // cacher le bouton à chaque update

    const lines = text.trim().split("\n");
    let winner = null;
    let currentPlayer = null;

    lines.forEach(line => {
        if (line.startsWith("Winner:")) {
            winner = line.split(":")[1].trim();
        } else if (line.startsWith("CurrentPlayer:")) {
            currentPlayer = line.split(":")[1].trim();
        } else {
            const rowDiv = document.createElement("div");
            rowDiv.classList.add("row");
            line.split(" ").forEach(cell => {
                const img = document.createElement("img");
                img.classList.add("cell");
                if (cell === "Paris") img.src = "/css/images/PSG.png";
                else if (cell === "Barcelone") img.src = "/css/images/BAR.png";
                else img.src = "/css/images/empty.png";
                rowDiv.appendChild(img);
            });
            boardDiv.appendChild(rowDiv);
        }
    });

    if (winner) {
        winnerDiv.textContent = "Le gagnant est : " + winner;
        restartBtn.style.display = "inline-block";
        buttons.forEach(btn => btn.disabled = true); // désactiver les colonnes
    } else if (currentPlayer) {
        winnerDiv.textContent = "Joueur courant : " + currentPlayer;
    }

    // Vérifier match nul (toutes les cases remplies)
    const isDraw = Array.from(boardDiv.querySelectorAll(".cell")).every(img => !img.src.includes("empty.png"));
    if (!winner && isDraw) {
        winnerDiv.textContent = "Match nul !";
        restartBtn.style.display = "inline-block";
        buttons.forEach(btn => btn.disabled = true);
    }
}

// Restart button
restartBtn.addEventListener("click", () => {
    location.reload();
});

// Démarrage du jeu
fetch("/start")
    .then(res => res.text())
    .then(data => updateBoard(data));

buttons.forEach(btn => {
    btn.addEventListener("click", () => {
        const col = btn.getAttribute("data-col");
        fetch("/play?col=" + col)
            .then(res => res.text())
            .then(data => updateBoard(data));
    });
});
    </script>
</body>
</html>